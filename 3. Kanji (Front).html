<div class="japanese" style="font-size:60px;">{{Vocabulary-Kana}}</div>

<div style="font-size: 16px; ">{{Vocabulary-Pos}}</div>

<canvas id="kanjiCanvas" width="800" height="200"></canvas><br/>
<button onclick="undo()">Undo</button><button onclick="erase()">Clear</button>
<script>
    var strokes = [];
    function erase() {
        const canvas = document.getElementById("kanjiCanvas");
        const ctx = canvas.getContext("2d");
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        strokes.length = 0;
    }
    function undo() {
        const canvas = document.getElementById("kanjiCanvas");
        const ctx = canvas.getContext("2d");
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        strokes.splice(strokes.length - 1, 1);
        for(const stroke of strokes) {
            const xs = stroke[0], ys = stroke[1], length = xs.length;
            for(let i = 1; i < length; i += 1) {
                ctx.beginPath();
                ctx.moveTo(xs[i - 1], ys[i - 1]);
                ctx.lineTo(xs[i], ys[i]);
                ctx.stroke();
            }
        }
    }
    var kanjiCanvasAnimationFrame;
    if(kanjiCanvasAnimationFrame) window.cancelAnimationFrame(kanjiCanvasAnimationFrame);
    (function() {
        const canvas = document.getElementById("kanjiCanvas");
        const ctx = canvas.getContext("2d");
        ctx.lineWidth = 5;
        ctx.strokeStyle = "white";
        ctx.lineCap = "round";
        let mouseIsPressed = false, mouseX = mouseY = xPoint = yPoint = 0;
        canvas.onkeydown = e => { if(e.ctrlKey && e.key === "z") undo(); };
        canvas.onmousedown = e => {
            if(e.button === 0) {
                const bounds = e.currentTarget.getBoundingClientRect();
                const x = e.clientX - bounds.left,
                      y = e.clientY - bounds.top;
                mouseIsPressed = true;
                strokes.push([[x], [y]]);
                xPoint = x;
                yPoint = y;
            }
        };
        canvas.onmouseup = e => { if(e.button === 0) mouseIsPressed = false; };
        canvas.onmousemove = e => {
            const bounds = e.currentTarget.getBoundingClientRect();
            const x = e.clientX - bounds.left,
                    y = e.clientY - bounds.top;
            mouseX = x;
            mouseY = y;
        };
        let ptime = 0;
        function draw(time) {
            kanjiCanvasAnimationFrame = window.requestAnimationFrame(draw);
            const dt = time - ptime;
            ptime = time;
            if(strokes.length > 0) {
                const currentStroke = strokes[strokes.length - 1], lastStroke = currentStroke[0].length - 1, xLast = currentStroke[0][lastStroke], yLast = currentStroke[1][lastStroke];
                if(mouseIsPressed) {
                    if(xLast !== xPoint || yLast !== yPoint) {
                        currentStroke[0].push(xPoint);
                        currentStroke[1].push(yPoint);
                        ctx.beginPath();
                        ctx.moveTo(xLast, yLast);
                        ctx.lineTo(xPoint, yPoint);
                        ctx.stroke();
                    }
                    const SMOOTHING = 0.1;
                    xPoint += (mouseX - xPoint) * (1 - SMOOTHING) / (1 + dt * SMOOTHING);
                    yPoint += (mouseY - yPoint) * (1 - SMOOTHING) / (1 + dt * SMOOTHING);
                }
            }
        }
        kanjiCanvasAnimationFrame = window.requestAnimationFrame(draw);
    })();
</script>

<br/><br/><br/><br/><br/>
<div id="example-sentence" class="japanese" style="font-size:40px;">{{furigana:Sentence-Clozed}}</div>
<div style="font-size: 20px; ">{{Vocabulary-English}}</div>